<!DOCTYPE html>
<html>
    <head>
        <title>High-Speed Auction War</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <style>
            @keyframes pulse-red {
                0%, 100% { transform: scale(1); }
                50% { transform: scale(1.05); color: #ef4444; }
            }
            .timer-pulse { animation: pulse-red 1s infinite; }
        </style>
    </head>
    <body class="bg-gray-900 text-white flex flex-col items-center justify-center min-h-screen font-sans">
        
        <h1 class="text-5xl font-extrabold mb-2 tracking-tight">AUCTION WAR</h1>
        <p class="text-gray-400 mb-8 uppercase tracking-widest text-sm">Real-Time Distributed Bidding</p>

        <div id="timer" class="text-4xl font-black mb-4 py-2 px-6 bg-gray-800 rounded-lg shadow-inner border border-gray-700">
            Time: 30s
        </div>

        <div id="price" class="text-8xl font-mono font-bold text-green-400 mb-10 drop-shadow-xl">
            Waiting...
        </div>

        <button id="bidButton" onclick="sendBid()" class="bg-blue-600 hover:bg-blue-500 text-white font-black py-6 px-12 rounded-2xl text-3xl shadow-2xl transform active:scale-90 transition-all border-b-8 border-blue-800">
            BID +$10!
        </button>

        <div class="mt-12 w-80">
            <h3 class="text-gray-500 text-xs font-bold uppercase mb-2 border-b border-gray-800 pb-1">Activity Feed</h3>
            <ul id='messages' class="text-sm text-gray-400 h-24 overflow-y-auto space-y-1"></ul>
        </div>

        <script>
            // --- DYNAMIC WEBSOCKET LOGIC ---
            // This detects if we are on local (ws) or production (wss)
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const host = window.location.host;
            const wsUrl = `${protocol}//${host}/ws`;
            
            var ws = new WebSocket(wsUrl);

            ws.onopen = function() {
                addMessage("‚úÖ Connected to Auction Server!");
            };

            ws.onclose = function() {
                addMessage("‚ùå Disconnected from Server.");
            };

            ws.onmessage = function(event) {
                const data = event.data;

                // 1. Handle Timer Updates
                if (data.includes("Time:")) {
                    const timerDiv = document.getElementById('timer');
                    timerDiv.innerText = data;
                    
                    const seconds = parseInt(data.match(/\d+/));
                    if (seconds <= 5) {
                        timerDiv.classList.add('timer-pulse', 'text-red-500');
                    } else {
                        timerDiv.classList.remove('timer-pulse', 'text-red-500');
                    }
                } 
                
                // 2. Handle Price Updates
                else if (data.includes("Price:")) {
                    document.getElementById('price').innerText = data.replace("Price: ", "");
                } 
                
                // 3. Handle Game End
                else if (data.includes("SOLD!")) {
                    document.getElementById('timer').innerText = "SOLD!";
                    document.getElementById('timer').classList.remove('timer-pulse');
                    document.getElementById('timer').classList.add('bg-red-600');
                    document.getElementById('bidButton').disabled = true;
                    document.getElementById('bidButton').classList.add('opacity-50', 'cursor-not-allowed');
                    addMessage("üî® AUCTION CLOSED");
                }
                
                // 4. Activity Logs
                else {
                    addMessage(data);
                }
            };

            function addMessage(text) {
                var messages = document.getElementById('messages');
                var message = document.createElement('li');
                message.textContent = "> " + text;
                messages.prepend(message);
            }

            function sendBid() {
                if (ws.readyState === WebSocket.OPEN) {
                    ws.send("BID");
                }
            }
        </script>
    </body>
</html>
